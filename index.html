<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>🇲🇽 Selfies que dan vida - Nuevo Diseño</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'Roboto', sans-serif; background: #f5f7fa; color: #333; }
  
  header {
    background: linear-gradient(90deg,#ff5252,#ff1744);
    color: white; text-align: center; padding: 2rem 1rem;
    font-size: 2rem; font-weight: 700; letter-spacing: 1px;
  }

  main { max-width: 900px; margin: 2rem auto; padding: 1rem; display: flex; flex-direction: column; gap: 2rem; }

  .card {
    background: white; border-radius: 20px; padding: 1.5rem;
    box-shadow: 0 10px 25px rgba(0,0,0,0.08); transition: 0.3s;
  }
  .card:hover { box-shadow: 0 15px 30px rgba(0,0,0,0.12); }

  h2 { color: #ff1744; margin-bottom: 1rem; font-size: 1.6rem; }
  label { font-weight: 500; margin-bottom: 0.3rem; display: block; }
  
  input[type="file"], input[type="text"], button {
    width: 100%; padding: 0.8rem; margin-bottom: 1rem; border-radius: 12px; border: 1px solid #ccc;
    font-size: 1rem; outline: none; transition: 0.3s;
  }
  input[type="file"]:hover, input[type="text"]:hover { border-color: #ff1744; }
  
  button {
    background: #ff1744; color: white; font-weight: 600; border: none; cursor: pointer; transition: 0.3s;
    border-radius: 12px;
  }
  button:hover { background: #d50000; }

  canvas { display: block; margin: 1rem auto; max-width: 100%; border-radius: 20px; }

  .donate-section p { margin-bottom: 0.5rem; line-height: 1.3; }

  @media(max-width:600px){
    header{ font-size:1.6rem; }
  }
</style>
</head>
<body>

<header>🇲🇽 Selfies que dan vida</header>

<main>
  <!-- Selección de foto -->
  <div class="card">
    <h2>1️⃣ Selecciona tu foto</h2>
    <label for="photoInput">Sube una imagen o toma selfie</label>
    <input type="file" id="photoInput" accept="image/*" capture="environment">
    <canvas id="photoCanvas"></canvas>
  </div>

  <!-- Personalización de marco y mensaje -->
  <div class="card">
    <h2>2️⃣ Personaliza tu marco</h2>
    <label for="locationInput">DESDE:</label>
    <input type="text" id="locationInput" placeholder="Escribe tu ubicación">

    <label for="customText">Tu mensaje solidario:</label>
    <input type="text" id="customText" placeholder="Ej. ¡Unidos con el #NorteDeVeracruz!">

    <label for="frameSelect">Elige un marco:</label>
    <select id="frameSelect">
      <option value="">Sin marco</option>
      <option value="https://i.imgur.com/3Lk3wQI.png">Marco 1</option>
      <option value="https://i.imgur.com/yrZ1wCt.png">Marco 2</option>
      <option value="https://i.imgur.com/Ys9UZ1D.png">Marco 3</option>
    </select>
  </div>

  <!-- Guardar y compartir -->
  <div class="card">
    <h2>3️⃣ Guarda y comparte</h2>
    <button id="downloadBtn">💾 Guardar imagen</button>
    <button id="shareBtn">📤 Compartir imagen</button>
  </div>

  <!-- Donación -->
  <div class="card donate-section">
    <h2>4️⃣ Dona directamente</h2>
    <p>Donaciones #Cruz Roja Mexicana u otra institución confiable</p>
    <p>Cuenta: 0404040406</p>
    <p>Clave interbancaria: 012180004040404062</p>
    <p>Banco: BBVA Bancomer</p>
    <p>A nombre de: Cruz Roja Mexicana IAP</p>
    <button onclick="window.open('https://www.cruzrojamexicana.org.mx/donativos','_blank')">Donar ahora</button>
  </div>
</main>

<script>
const photoInput = document.getElementById('photoInput');
const canvas = document.getElementById('photoCanvas');
const ctx = canvas.getContext('2d');
const locationInput = document.getElementById('locationInput');
const customText = document.getElementById('customText');
const frameSelect = document.getElementById('frameSelect');
const downloadBtn = document.getElementById('downloadBtn');
const shareBtn = document.getElementById('shareBtn');

let currentImage = null;
let currentFrame = null;

photoInput.addEventListener('change', e => {
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = function(event){
    const img = new Image();
    img.onload = () => { currentImage = img; drawCanvas(); }
    img.src = event.target.result;
  }
  reader.readAsDataURL(file);
});

frameSelect.addEventListener('change', ()=>{
  if(frameSelect.value){
    currentFrame = new Image();
    currentFrame.src = frameSelect.value;
    currentFrame.onload = drawCanvas;
  } else {
    currentFrame = null;
    drawCanvas();
  }
});

function drawCanvas(){
  if(!currentImage) return;
  const width = Math.min(currentImage.width, 800);
  const scale = width / currentImage.width;
  const height = currentImage.height * scale;
  canvas.width = width;
  canvas.height = height + 160;

  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.drawImage(currentImage,0,0,width,height);

  // Marco superior rojo
  ctx.fillStyle = 'rgba(255,23,68,0.85)';
  ctx.fillRect(0,0,width,160);

  ctx.fillStyle = 'white';
  ctx.font = 'bold 22px Roboto';
  ctx.textAlign = 'center';
  ctx.fillText(`DESDE: ${locationInput.value || 'Ubicación no especificada'}`, width/2,50);
  ctx.fillText(customText.value || 'Tu mensaje aquí', width/2,110);

  if(currentFrame) ctx.drawImage(currentFrame,0,0,width,height);
}

locationInput.addEventListener('input', drawCanvas);
customText.addEventListener('input', drawCanvas);

// Descargar imagen
downloadBtn.addEventListener('click', ()=>{
  if(!currentImage) return;
  const link = document.createElement('a');
  link.download = 'selfie-solidaria.png';
  link.href = canvas.toDataURL();
  link.click();
});

// Compartir imagen usando API nativa
shareBtn.addEventListener('click', async ()=>{
  if(!currentImage) return;
  canvas.toBlob(async blob=>{
    const filesArray = [new File([blob], 'selfie-solidaria.png', {type: blob.type})];
    if(navigator.canShare && navigator.canShare({files: filesArray})){
      try{
        await navigator.share({
          files: filesArray,
          title: 'Selfie Solidaria',
          text: '¡Mira mi selfie solidaria!'
        });
      } catch(err){
        alert('Error compartiendo: '+err);
      }
    } else {
      alert('Tu navegador no soporta compartir archivos directamente. Puedes descargar la imagen y compartirla manualmente.');
    }
  });
});
</script>

</body>
 </html>
