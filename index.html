<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>🇲🇽 Selfies que dan vida - PRO Mejorado</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
body {
  margin:0;
  font-family:'Poppins',sans-serif;
  background:#ffe6f0;
  color:#333;
}
header {
  background:#ff80ab;
  color:white;
  text-align:center;
  padding:3rem 1rem;
  border-bottom-left-radius: 50px;
  border-bottom-right-radius: 50px;
}
header h1 {
  font-size:2.8rem;
  margin-bottom:0.5rem;
  font-weight:700;
}
header p {
  font-size:1.3rem;
  font-weight:500;
}

main {
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  padding:2rem;
  gap:2rem;
}

.canvas-container {
  background:white;
  border-radius:20px;
  padding:1rem;
  box-shadow:0 10px 25px rgba(0,0,0,0.1);
  display:flex;
  flex-direction:column;
  align-items:center;
  max-width:500px;
  width:100%;
}

.controls-container {
  background:white;
  border-radius:20px;
  padding:1rem;
  box-shadow:0 10px 25px rgba(0,0,0,0.1);
  max-width:400px;
  width:100%;
  display:flex;
  flex-direction:column;
  gap:1rem;
}

label {
  font-weight:600;
  margin-bottom:0.3rem;
  display:block;
  color:#ff4081;
}

input[type="text"], select, button {
  width:100%;
  padding:0.75rem;
  border-radius:12px;
  border:1px solid #ff80ab;
  font-size:1rem;
  outline:none;
  transition:0.3s;
}
input[type="text"]:hover, select:hover {
  border-color:#ff1744;
}

button {
  background:#ff4081;
  color:white;
  font-weight:600;
  border:none;
  cursor:pointer;
  transition:0.3s;
  border-radius:12px;
}
button:hover {
  background:#e91e63;
}

canvas {
  border-radius:20px;
  max-width:100%;
  margin-bottom:1rem;
  border:3px solid #ff80ab;
}

.support-section {
  margin-top:2rem;
  text-align:center;
}
.support-section h2 {
  color:#ff4081;
}
.support-section p {
  margin-bottom:0.5rem;
  line-height:1.3;
  font-weight:500;
}

@media(max-width:900px){
  main{
    flex-direction:column;
    align-items:center;
  }
}
</style>
</head>
<body>

<header>
<h1>🇲🇽 Selfies que dan vida</h1>
<p>Sube tu selfie, agrega un mensaje y difunde solidaridad 💖</p>
</header>

<main>
  <div class="canvas-container">
    <canvas id="photoCanvas"></canvas>
  </div>

  <div class="controls-container">
    <label>Sube tu foto</label>
    <button id="takePhotoBtn">📸 Tomar foto</button>
    <button id="selectPhotoBtn">🖼 Seleccionar imagen</button>
    <input type="file" id="photoInput" accept="image/*" style="display:none;">

    <label for="locationInput">Ubicación (DESDE:)</label>
    <input type="text" id="locationInput" placeholder="Escribe tu ubicación">

    <label for="customText">Mensaje solidario</label>
    <input type="text" id="customText" placeholder="Escribe tu mensaje">

    <label for="frameSelect">Elegir marco</label>
    <select id="frameSelect">
      <option value="none">Sin marco</option>
      <option value="gradient">Gradient</option>
      <option value="polaroid">Polaroid</option>
      <option value="floral">Floral</option>
    </select>

    <button id="downloadBtn">💾 Guardar imagen</button>
    <button id="shareBtn">📤 Compartir imagen</button>
  </div>
</main>

<div class="support-section">
  <h2>💖 Apoya la causa</h2>
  <p>Gracias por difundir solidaridad y buenos mensajes con tu selfie.</p>
</div>

<script>
const canvas = document.getElementById('photoCanvas');
const ctx = canvas.getContext('2d');
const photoInput = document.getElementById('photoInput');
const takePhotoBtn = document.getElementById('takePhotoBtn');
const selectPhotoBtn = document.getElementById('selectPhotoBtn');
const locationInput = document.getElementById('locationInput');
const customText = document.getElementById('customText');
const frameSelect = document.getElementById('frameSelect');
const downloadBtn = document.getElementById('downloadBtn');
const shareBtn = document.getElementById('shareBtn');

let currentImage = null;
let currentFrame = 'none';

// Manejar botones de foto
takePhotoBtn.addEventListener('click', ()=>{
  photoInput.accept="image/*;capture=camera";
  photoInput.click();
});
selectPhotoBtn.addEventListener('click', ()=>{
  photoInput.accept="image/*";
  photoInput.click();
});

photoInput.addEventListener('change', e=>{
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = function(event){
    const img = new Image();
    img.onload = ()=>{ currentImage=img; drawCanvas(); }
    img.src = event.target.result;
  }
  reader.readAsDataURL(file);
});

// Cambiar marco
frameSelect.addEventListener('change', ()=>{
  currentFrame = frameSelect.value;
  drawCanvas();
});

locationInput.addEventListener('input', drawCanvas);
customText.addEventListener('input', drawCanvas);

// Dibujar canvas
function drawCanvas(){
  if(!currentImage) return;
  const width=Math.min(currentImage.width,500);
  const scale = width / currentImage.width;
  const height = currentImage.height*scale;
  canvas.width=width;
  canvas.height=height+150;

  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.drawImage(currentImage,0,0,width,height);

  // Fondo del texto
  ctx.fillStyle='rgba(255,64,129,0.85)';
  ctx.fillRect(0,0,width,150);

  // Texto
  ctx.fillStyle='white';
  ctx.font='bold 20px Poppins';
  ctx.textAlign='center';
  ctx.fillText(`DESDE: ${locationInput.value || 'Ubicación no especificada'}`, width/2,45);
  ctx.fillText(customText.value || 'Tu mensaje aquí', width/2,100);

  // Marcos dibujados directamente
  if(currentFrame==='gradient'){
    const grad = ctx.createLinearGradient(0,0,width,height);
    grad.addColorStop(0,'#ff80ab');
    grad.addColorStop(1,'#ff4081');
    ctx.strokeStyle = grad;
    ctx.lineWidth = 20;
    ctx.strokeRect(0,0,width,height);
  } else if(currentFrame==='polaroid'){
    ctx.strokeStyle = '#fff';
    ctx.lineWidth = 25;
    ctx.shadowColor = 'rgba(0,0,0,0.3)';
    ctx.shadowBlur = 15;
    ctx.strokeRect(0,0,width,height);
    ctx.shadowBlur = 0;
  } else if(currentFrame==='floral'){
    ctx.strokeStyle = '#ff80ab';
    ctx.lineWidth = 15;
    ctx.setLineDash([10,10]);
    ctx.strokeRect(0,0,width,height);
    ctx.setLineDash([]);
  }
}

// Descargar
downloadBtn.addEventListener('click', ()=>{
  if(!currentImage) return;
  const link=document.createElement('a');
  link.download='selfie-solidaria.png';
  link.href=canvas.toDataURL();
  link.click();
});

// Compartir
shareBtn.addEventListener('click', async ()=>{
  if(!currentImage) return;
  canvas.toBlob(async blob=>{
    const filesArray=[new File([blob],'selfie-solidaria.png',{type:blob.type})];
    if(navigator.canShare && navigator.canShare({files:filesArray})){
      try{
        await navigator.share({files:filesArray,title:'Selfie Solidaria',text:'¡Mira mi selfie solidaria!'});
      } catch(err){ alert('Error compartiendo: '+err); }
    } else { alert('Tu navegador no soporta compartir archivos directamente. Descarga la imagen y compártela manualmente.'); }
  });
});
</script>

</body>
  </html>
