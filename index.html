<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>🇲🇽 Selfies que dan vida - Rediseño</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
body { margin:0; font-family:'Roboto',sans-serif; background:#f0f2f5; color:#333; }
header { background:#ff1744; color:white; text-align:center; padding:3rem 1rem; }
header h1 { font-size:2.5rem; margin-bottom:0.5rem; }
header p { font-size:1.2rem; }

main { display:flex; flex-wrap:wrap; justify-content:center; padding:2rem; gap:2rem; }

.canvas-container {
  background:white; border-radius:20px; padding:1rem; box-shadow:0 10px 25px rgba(0,0,0,0.1);
  display:flex; flex-direction:column; align-items:center; max-width:500px; width:100%;
}

.controls-container {
  background:white; border-radius:20px; padding:1rem; box-shadow:0 10px 25px rgba(0,0,0,0.1);
  max-width:400px; width:100%; display:flex; flex-direction:column; gap:1rem;
}

label { font-weight:500; margin-bottom:0.3rem; display:block; }
input[type="file"], input[type="text"], select, button { width:100%; padding:0.75rem; border-radius:12px; border:1px solid #ccc; font-size:1rem; outline:none; transition:0.3s; }
input[type="file"]:hover, input[type="text"]:hover, select:hover { border-color:#ff1744; }
button { background:#ff1744; color:white; font-weight:600; border:none; cursor:pointer; transition:0.3s; border-radius:12px; }
button:hover { background:#d50000; }

canvas { border-radius:20px; max-width:100%; margin-bottom:1rem; }

.donate-section { margin-top:2rem; text-align:center; }
.donate-section p { margin-bottom:0.5rem; line-height:1.3; }
@media(max-width:900px){ main{flex-direction:column;align-items:center;} }
</style>
</head>
<body>

<header>
<h1>🇲🇽 Selfies que dan vida</h1>
<p>Sube tu selfie, agrega un mensaje y difunde solidaridad</p>
</header>

<main>
  <!-- Canvas -->
  <div class="canvas-container">
    <canvas id="photoCanvas"></canvas>
  </div>

  <!-- Controles -->
  <div class="controls-container">
    <label for="photoInput">Selecciona imagen o toma selfie</label>
    <input type="file" id="photoInput" accept="image/*" capture="user">

    <label for="locationInput">Ubicación (DESDE:)</label>
    <input type="text" id="locationInput" placeholder="Escribe tu ubicación">

    <label for="customText">Mensaje solidario</label>
    <input type="text" id="customText" placeholder="Escribe tu mensaje">

    <label for="frameSelect">Elegir marco</label>
    <select id="frameSelect">
      <option value="">Sin marco</option>
      <option value="https://i.imgur.com/3Lk3wQI.png">Marco 1</option>
      <option value="https://i.imgur.com/yrZ1wCt.png">Marco 2</option>
      <option value="https://i.imgur.com/Ys9UZ1D.png">Marco 3</option>
    </select>

    <button id="downloadBtn">💾 Guardar imagen</button>
    <button id="shareBtn">📤 Compartir imagen</button>
  </div>
</main>

<div class="donate-section">
  <h2>💖 Dona directamente</h2>
  <p>Cuenta: 0404040406</p>
  <p>Clave interbancaria: 012180004040404062</p>
  <p>Banco: BBVA Bancomer</p>
  <p>A nombre de: Cruz Roja Mexicana IAP</p>
  <button onclick="window.open('https://www.cruzrojamexicana.org.mx/donativos','_blank')">Donar ahora</button>
</div>

<script>
const photoInput = document.getElementById('photoInput');
const canvas = document.getElementById('photoCanvas');
const ctx = canvas.getContext('2d');
const locationInput = document.getElementById('locationInput');
const customText = document.getElementById('customText');
const frameSelect = document.getElementById('frameSelect');
const downloadBtn = document.getElementById('downloadBtn');
const shareBtn = document.getElementById('shareBtn');

let currentImage = null;
let currentFrame = null;

photoInput.addEventListener('change', e=>{
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload=function(event){
    const img = new Image();
    img.onload=()=>{ currentImage=img; drawCanvas(); }
    img.src=event.target.result;
  }
  reader.readAsDataURL(file);
});

frameSelect.addEventListener('change', ()=>{
  if(frameSelect.value){
    currentFrame=new Image();
    currentFrame.src=frameSelect.value;
    currentFrame.onload=drawCanvas;
  } else { currentFrame=null; drawCanvas(); }
});

function drawCanvas(){
  if(!currentImage) return;
  const width=Math.min(currentImage.width,500);
  const scale = width / currentImage.width;
  const height = currentImage.height*scale;
  canvas.width=width;
  canvas.height=height+150;

  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.drawImage(currentImage,0,0,width,height);

  ctx.fillStyle='rgba(255,23,68,0.85)';
  ctx.fillRect(0,0,width,150);

  ctx.fillStyle='white';
  ctx.font='bold 20px Roboto';
  ctx.textAlign='center';
  ctx.fillText(`DESDE: ${locationInput.value || 'Ubicación no especificada'}`, width/2,45);
  ctx.fillText(customText.value || 'Tu mensaje aquí', width/2,100);

  if(currentFrame) ctx.drawImage(currentFrame,0,0,width,height);
}

locationInput.addEventListener('input', drawCanvas);
customText.addEventListener('input', drawCanvas);

downloadBtn.addEventListener('click', ()=>{
  if(!currentImage) return;
  const link=document.createElement('a');
  link.download='selfie-solidaria.png';
  link.href=canvas.toDataURL();
  link.click();
});

shareBtn.addEventListener('click', async ()=>{
  if(!currentImage) return;
  canvas.toBlob(async blob=>{
    const filesArray=[new File([blob],'selfie-solidaria.png',{type:blob.type})];
    if(navigator.canShare && navigator.canShare({files:filesArray})){
      try{
        await navigator.share({files:filesArray,title:'Selfie Solidaria',text:'¡Mira mi selfie solidaria!'});
      } catch(err){ alert('Error compartiendo: '+err); }
    } else { alert('Tu navegador no soporta compartir archivos directamente. Descarga la imagen y compártela manualmente.'); }
  });
});
</script>

</body>
 </html>
